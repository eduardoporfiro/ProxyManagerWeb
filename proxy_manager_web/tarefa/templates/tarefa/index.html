{% extends "core/base.html" %}
{% load staticfiles %}
{% block core_head %}
  <script src="{% static 'tarefa/blockly/blockly_compressed.js' %}"></script>
  <script src="{% static 'tarefa/blockly/blocks_compressed.js' %}"></script>
  <script src="{% static 'tarefa/blockly/javascript_compressed.js' %}"></script>
  <script src="{% static 'tarefa/blockly/msg/js/en.js' %}"></script>
    <script>
  Blockly.Blocks['execue'] = {
  init: function() {
    this.jsonInit({

  "type": "execue",
  "message0": "Atuadores %1 %2 %3 %4 %5 Executar quando %6 for %7",
  "args0": [
    {
      "type": "field_dropdown",
      "name": "Atuadores",
      "options": [
          {% if testes %}
          {% for teste in testes%}
        [
          "{{teste.sensor}}",
          "{{teste.id}}"
        ],
      {% endfor %}
      {% else %}
      [
          "sem Sensor",
          "0"
      ]
      {% endif %}
      ]
    },
    {
      "type": "field_input",
      "name": "Teste",
      "text": "Sensor"
    },
    {
      "type": "field_dropdown",
      "name": "Sensor",
      "options": [
        [
          "Sensor 1",
          "OPTIONNAME"
        ],
        [
          "Sensor 2",
          "OPTIONNAME"
        ],
        [
          "Sensor 3",
          "OPTIONNAME"
        ]
      ]
    },
    {
      "type": "input_dummy",
      "align": "CENTRE"
    },
    {
      "type": "input_statement",
      "name": "NAME",
      "check": "String"
    },
    {
      "type": "field_dropdown",
      "name": "When",
      "options": [
        [
          "option",
          "OPTIONNAME"
        ],
        [
          "option",
          "OPTIONNAME"
        ],
        [
          "option",
          "OPTIONNAME"
        ]
      ]
    },
    {
      "type": "field_dropdown",
      "name": "Option",
      "options": [
        [
          "option",
          "OPTIONNAME"
        ],
        [
          "option",
          "OPTIONNAME"
        ],
        [
          "option",
          "OPTIONNAME"
        ]
      ]
    }
  ],
  "inputsInline": false,
  "colour": 230,
  "tooltip": "",
  "helpUrl": ""
},
{
  "type": "s_dfnvsd",
  "message0": "",
  "colour": 230,
  "tooltip": "",
  "helpUrl": ""
}
    );
  }
};

  Blockly.Blocks['s_dfnvsd'] = {
  init: function() {
    this.setColour(230);
 this.setTooltip("");
 this.setHelpUrl("");
  }
};

  Blockly.Blocks['string_length'] = {
  init: function() {
    this.jsonInit({
      "message0": 'length of %1',
      "args0": [
        {
          "type": "input_value",
          "name": "VALUE",
          "check": "String"
        }
      ],
      "output": "Number",
      "colour": 160,
      "tooltip": "Returns number of letters in the provided text.",
      "helpUrl": "http://www.w3schools.com/jsref/jsref_length_string.asp"
    });
  }
};

</script>
  <style>
    body {
      background-color: #fff;
      font-family: sans-serif;
    }
    h1 {
      font-weight: normal;
      font-size: 140%;
    }
  </style>
{% endblock %}
{% block content %}
  <div id="blocklyDiv" style="height: 480px; width: 600px;"></div>

  <xml id="toolbox" style="display: none">
    <category name="Logic" colour="%{BKY_LOGIC_HUE}">
      <block type="controls_if"></block>
      <block type="logic_compare"></block>
      <block type="logic_operation"></block>
      <block type="logic_negate"></block>
      <block type="logic_boolean"></block>
    </category>
    <category name="Loops" colour="%{BKY_LOOPS_HUE}">
      <block type="controls_repeat_ext">
        <value name="TIMES">
          <block type="math_number">
            <field name="NUM">10</field>
          </block>
        </value>
      </block>
      <block type="controls_whileUntil"></block>
    </category>
    <category name="Math" colour="%{BKY_MATH_HUE}">
      <block type="math_number">
        <field name="NUM">123</field>
      </block>
      <block type="math_arithmetic"></block>
      <block type="math_single"></block>
    </category>
    <category name="Text" colour="%{BKY_TEXTS_HUE}">
      <block type="text"></block>
      <block type="text_length"></block>
      <block type="text_print"></block>
    </category>
  <category name="Category 1">
    <block type="execue">
      <field name="Atuadores">OPTIONNAME</field>
      <field name="Teste">Sensor</field>
      <field name="Sensor">OPTIONNAME</field>
      <field name="When">OPTIONNAME</field>
      <field name="Option">OPTIONNAME</field>
    </block>
    <block type="s_dfnvsd"></block>
    <block type="logic_compare">
      <field name="OP">EQ</field>
    </block>
    <block type="lists_create_with">
      <mutation items="3"></mutation>
    </block>
    <block type="controls_if"></block>
    <block type="math_arithmetic">
      <field name="OP">ADD</field>
      <value name="A">
        <shadow type="math_number">
          <field name="NUM">1</field>
        </shadow>
      </value>
      <value name="B">
        <shadow type="math_number">
          <field name="NUM">1</field>
        </shadow>
      </value>
    </block>
  </category>
  </xml>
  <script>
    var demoWorkspace = Blockly.inject('blocklyDiv',
        {media: "{% static 'block/blockly/media/' %}",
         toolbox: document.getElementById('toolbox')});
    Blockly.Xml.domToWorkspace(document.getElementById('startBlocks'),
                               demoWorkspace);

    function showCode() {
      // Generate JavaScript code and display it.
      Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
      var code = Blockly.JavaScript.workspaceToCode(demoWorkspace);
      alert(code);
    }

    function runCode() {
      // Generate JavaScript code and run it.
      window.LoopTrap = 1000;
      Blockly.JavaScript.INFINITE_LOOP_TRAP =
          'if (--window.LoopTrap == 0) throw "Infinite loop.";\n';
      var code = Blockly.JavaScript.workspaceToCode(demoWorkspace);
      Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
      try {
        eval(code);
      } catch (e) {
        alert(e);
      }
    }
  </script>

{% endblock %}
